- name: 'Create the certificate for the teleport server'
  hosts: 'teleport-server'
  gather_facts: 'yes'
  become: 'true'

  tasks:

    - name: 'create directory /var/lib/teleport/'
      file:
        path: '/var/lib/teleport/'
        state: 'directory'
        owner: 'root'
        group: 'root'
        mode: '0755'

    - name: 'Create /usr/local/bin/create_certificate.sh'
      template:
        src: 'certificate.sh.j2'
        dest: '/usr/local/bin/create_certificate.sh'
        owner: 'root'
        group: 'root'
        mode: '0755'

    - name: 'create certificate'
      command:
        cmd: '/usr/local/bin/create_certificate.sh'
        creates: '/var/lib/teleport/fullchain.pem'
